---
phase: 09-maestro-e2e-tests
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - maestro/flows/settings/01-theme-toggle.yaml
  - maestro/flows/settings/02-language-switch.yaml
  - maestro/config.yaml
autonomous: true

must_haves:
  truths:
    - "Theme toggle flow tests switching between light and dark modes"
    - "Language switch flow tests changing from English to Arabic and back"
    - "Both flows capture visual state changes with screenshots"
  artifacts:
    - path: "maestro/flows/settings/01-theme-toggle.yaml"
      provides: "Theme toggle E2E test"
      contains: "Theme"
    - path: "maestro/flows/settings/02-language-switch.yaml"
      provides: "Language switch E2E test"
      contains: "Language"
  key_links:
    - from: "maestro/config.yaml"
      to: "maestro/flows/settings/"
      via: "flows.settings array"
      pattern: "settings"
---

<objective>
Create Maestro E2E tests for Settings flows - Theme Toggle and Language Switch.

Purpose: Complete P0 critical user flow coverage for app personalization settings - essential for user preference and accessibility testing.

Output: Two new Maestro flow files in settings/ directory that test theme and language switching, registered in config.yaml.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@maestro/config.yaml
@maestro/flows/home/01-home-screen.yaml
@maestro/flows/auth/01-phone-auth.yaml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Theme Toggle Flow</name>
  <files>maestro/flows/settings/01-theme-toggle.yaml</files>
  <action>
Create a Maestro flow file that tests theme switching:

1. Launch app with `appId: ${APP_ID}`
2. Navigate to Settings (tap "Settings", "Profile", "الإعدادات", gear icon)
3. Capture INITIAL theme state:
   - Take screenshot of current theme
   - Note: Cannot programmatically detect theme, rely on visual diff
4. Find and tap Theme toggle:
   - Look for "Theme", "Dark Mode", "Light Mode", "الوضع الليلي", "المظهر"
   - Tap the toggle/switch/option
5. Wait for theme change to apply:
   - `extendedWaitUntil` with short timeout for UI update
6. Capture NEW theme state:
   - Take screenshot showing changed theme
7. Toggle BACK to original:
   - Tap theme toggle again
   - Capture screenshot
8. Verify theme persists:
   - Navigate away (go to Home)
   - Return to Settings
   - Capture screenshot to confirm theme persisted

Screenshots in `screenshots/settings/theme/`:
- 01-settings-initial.png
- 02-theme-before.png
- 03-theme-after-toggle.png
- 04-theme-toggled-back.png
- 05-theme-persisted.png

Use patterns:
- `anyOf` for bilingual text
- `runFlow` with `when` for conditional paths (if toggle is checkbox vs button)
  </action>
  <verify>Run `maestro test maestro/flows/settings/01-theme-toggle.yaml` - flow completes</verify>
  <done>Theme toggle flow file exists with toggle test and screenshot capture at each state</done>
</task>

<task type="auto">
  <name>Task 2: Create Language Switch Flow</name>
  <files>maestro/flows/settings/02-language-switch.yaml</files>
  <action>
Create a Maestro flow file that tests language switching:

1. Launch app with `appId: ${APP_ID}`
2. Navigate to Settings
3. Capture INITIAL language state:
   - Take screenshot showing current language
4. Find Language setting:
   - Look for "Language", "اللغة", "English", "العربية"
   - Tap to open language selector
5. Switch to ARABIC (if currently English):
   - Tap "Arabic", "العربية", "عربي"
   - Wait for UI to update
6. Capture ARABIC state:
   - Take screenshot showing Arabic UI
   - Assert Arabic text visible (use known Arabic strings like "الإعدادات", "الرئيسية")
7. Switch BACK to English:
   - Find language setting (now in Arabic - look for "اللغة")
   - Select English
   - Wait for UI update
8. Capture ENGLISH restored:
   - Take screenshot
   - Assert English text visible ("Settings", "Home")
9. Verify language persists:
   - Navigate to Home
   - Return to Settings
   - Confirm language setting retained

Screenshots in `screenshots/settings/language/`:
- 01-initial-language.png
- 02-language-selector.png
- 03-switched-to-arabic.png
- 04-arabic-ui.png
- 05-switched-to-english.png
- 06-language-persisted.png

Critical: Use `assertVisible` to verify actual language change happened, not just UI update.
  </action>
  <verify>Run `maestro test maestro/flows/settings/02-language-switch.yaml` - flow completes</verify>
  <done>Language switch flow file exists with English-Arabic-English roundtrip test</done>
</task>

<task type="auto">
  <name>Task 3: Update Config for Settings Flows</name>
  <files>maestro/config.yaml</files>
  <action>
Update maestro/config.yaml to register settings flows:

1. Add to `executionOrder.flowsOrder`:
   - `flows/settings/*.yaml` (add after home, before events)

2. Add new `settings` section to `flows`:
   ```yaml
   settings:
     - maestro/flows/settings/01-theme-toggle.yaml
     - maestro/flows/settings/02-language-switch.yaml
   ```

3. Ensure proper YAML formatting and indentation
  </action>
  <verify>Validate YAML syntax with Python or online validator</verify>
  <done>Config includes settings flows in execution order and flows section</done>
</task>

</tasks>

<verification>
- Both YAML files exist in maestro/flows/settings/
- Files follow Maestro syntax patterns
- Config.yaml updated with settings section
- Flows include bilingual text matching
- Screenshots captured at each state change
</verification>

<success_criteria>
- `maestro/flows/settings/01-theme-toggle.yaml` exists with theme toggle test
- `maestro/flows/settings/02-language-switch.yaml` exists with language roundtrip test
- Both flows capture before/after screenshots
- Config.yaml includes settings section with both flows
</success_criteria>

<output>
After completion, create `.planning/phases/09-maestro-e2e-tests/09-02-SUMMARY.md`
</output>

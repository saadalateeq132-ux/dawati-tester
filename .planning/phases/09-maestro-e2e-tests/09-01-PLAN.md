---
phase: 09-maestro-e2e-tests
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - maestro/flows/events/03-guest-management.yaml
  - maestro/flows/invitations/01-send-invitation.yaml
  - maestro/config.yaml
autonomous: true

must_haves:
  truths:
    - "Guest management flow tests add/edit guest and attendance toggle"
    - "Invitation flow tests sending and tracking invitations"
    - "Both flows run successfully with maestro test"
  artifacts:
    - path: "maestro/flows/events/03-guest-management.yaml"
      provides: "Guest management E2E test"
      contains: "Guest"
    - path: "maestro/flows/invitations/01-send-invitation.yaml"
      provides: "Invitation sending E2E test"
      contains: "Invitation"
  key_links:
    - from: "maestro/config.yaml"
      to: "maestro/flows/events/03-guest-management.yaml"
      via: "flows.events array"
      pattern: "03-guest-management.yaml"
    - from: "maestro/config.yaml"
      to: "maestro/flows/invitations/01-send-invitation.yaml"
      via: "flows.invitations array"
      pattern: "01-send-invitation.yaml"
---

<objective>
Create Maestro E2E tests for Guest Management and Invitation Sending flows.

Purpose: Complete P0 critical user flow coverage for event guest operations - the core wedding planning features users need daily.

Output: Two new Maestro flow files that test guest CRUD and invitation sending, registered in config.yaml.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@maestro/config.yaml
@maestro/flows/events/02-complete-wizard.yaml
@maestro/flows/auth/01-phone-auth.yaml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Guest Management Flow</name>
  <files>maestro/flows/events/03-guest-management.yaml</files>
  <action>
Create a Maestro flow file that tests the guest management feature:

1. Launch app with `appId: ${APP_ID}`
2. Navigate to an existing event (use EVENT_TITLE env var pattern)
3. Navigate to Guests tab/section (tap on "Guests", "Guest List", "الضيوف")
4. Test ADD guest:
   - Tap "Add Guest" / "+" / "إضافة ضيف"
   - Fill in name field (use "Test Guest" as input)
   - Fill in phone/email if required
   - Save the guest
   - Assert guest appears in list
5. Test EDIT guest:
   - Tap on the added guest
   - Modify the name (append " Updated")
   - Save changes
   - Assert updated name visible
6. Test ATTENDANCE toggle:
   - Find attendance toggle/checkbox for guest
   - Tap to toggle status
   - Assert visual change (checkmark, color change)
7. Capture screenshots at each step in `screenshots/events/guests/`

Follow existing patterns:
- Use `anyOf` for Arabic/English text matching
- Use `extendedWaitUntil` with 10-15s timeouts
- Use `optional: true` for fallback taps
- Include bilingual text options (Arabic + English)
  </action>
  <verify>Run `maestro test maestro/flows/events/03-guest-management.yaml` - flow should complete without errors (or show expected "not found" if app not running)</verify>
  <done>Guest management flow file exists with add/edit/toggle tests and proper bilingual support</done>
</task>

<task type="auto">
  <name>Task 2: Create Invitation Sending Flow</name>
  <files>maestro/flows/invitations/01-send-invitation.yaml</files>
  <action>
Create a Maestro flow file that tests invitation sending:

1. Launch app with `appId: ${APP_ID}`
2. Navigate to an existing event
3. Navigate to Invitations section (tap "Invitations", "Send Invite", "الدعوات")
4. Test SEND invitation:
   - Select a guest or enter recipient
   - Choose invitation template if available
   - Tap "Send" / "إرسال"
   - Assert confirmation (success message, sent status)
5. Test TRACK invitation status:
   - Navigate to sent invitations list
   - Verify invitation shows in list with status (Pending/Sent/Viewed)
   - Take screenshots of invitation status
6. Test RESEND if available:
   - Tap on sent invitation
   - Look for resend option
   - Capture screenshot
7. Capture screenshots at each step in `screenshots/invitations/`

Follow existing patterns from marketplace booking flow:
- Use `anyOf` for Arabic/English text
- Use `runFlow` with `when` for conditional paths
- Use `assertVisible` for validations
  </action>
  <verify>Run `maestro test maestro/flows/invitations/01-send-invitation.yaml` - flow should complete without errors</verify>
  <done>Invitation sending flow file exists with send/track tests and proper bilingual support</done>
</task>

<task type="auto">
  <name>Task 3: Update Maestro Config</name>
  <files>maestro/config.yaml</files>
  <action>
Update maestro/config.yaml to register the new flows:

1. Add to `executionOrder.flowsOrder`:
   - `flows/invitations/*.yaml` (new entry)

2. Add to `flows` section:
   ```yaml
   events:
     - maestro/flows/events/01-create-event.yaml
     - maestro/flows/events/02-complete-wizard.yaml
     - maestro/flows/events/03-guest-management.yaml  # NEW
   invitations:  # NEW section
     - maestro/flows/invitations/01-send-invitation.yaml
   ```

3. Ensure directory structure note is added if helpful
  </action>
  <verify>Validate YAML syntax: `python -c "import yaml; yaml.safe_load(open('maestro/config.yaml'))"` or similar</verify>
  <done>Config includes events/03-guest-management.yaml and invitations/01-send-invitation.yaml</done>
</task>

</tasks>

<verification>
- All YAML files pass syntax validation
- Flows follow established patterns (appId, env vars, screenshots)
- Bilingual support included (Arabic + English)
- Config.yaml updated with new flow references
</verification>

<success_criteria>
- `maestro/flows/events/03-guest-management.yaml` exists with 50+ lines
- `maestro/flows/invitations/01-send-invitation.yaml` exists with 40+ lines
- `maestro/config.yaml` includes both new flows
- Both flows use proper Maestro syntax with anyOf, extendedWaitUntil patterns
</success_criteria>

<output>
After completion, create `.planning/phases/09-maestro-e2e-tests/09-01-SUMMARY.md`
</output>

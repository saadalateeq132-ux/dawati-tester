---
phase: 09-maestro-e2e-tests
plan: 04
type: execute
wave: 2
depends_on: ["09-02"]
files_modified:
  - maestro/flows/settings/03-account-settings.yaml
  - maestro/config.yaml
autonomous: true

must_haves:
  truths:
    - "Account settings flow tests profile editing"
    - "Flow tests privacy settings access"
    - "Flow captures user profile state changes"
  artifacts:
    - path: "maestro/flows/settings/03-account-settings.yaml"
      provides: "Account settings E2E test"
      contains: "Profile"
  key_links:
    - from: "maestro/config.yaml"
      to: "maestro/flows/settings/03-account-settings.yaml"
      via: "flows.settings array"
      pattern: "03-account-settings.yaml"
---

<objective>
Create Maestro E2E test for Account Settings flow (P1 priority).

Purpose: Complete user settings coverage by testing profile editing and privacy settings - important for user account management but not blocking core event functionality.

Output: One Maestro flow file testing account/profile settings, added to existing settings section in config.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@maestro/config.yaml
@maestro/flows/settings/01-theme-toggle.yaml
@maestro/flows/settings/02-language-switch.yaml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Account Settings Flow</name>
  <files>maestro/flows/settings/03-account-settings.yaml</files>
  <action>
Create a Maestro flow that tests account/profile settings:

## Setup
```yaml
appId: ${APP_ID}
env:
  TEST_NAME: "Test User Updated"
  TEST_EMAIL: "updated@test.com"
```

## Flow Steps:

1. **Navigate to Settings**
   - Launch app
   - Tap Settings/Profile icon
   - Screenshot: `screenshots/settings/account/01-settings-main.png`

2. **Access Profile/Account Section**
   - Look for "Profile", "Account", "My Account", "الملف الشخصي", "حسابي"
   - Tap to enter profile section
   - Screenshot: `screenshots/settings/account/02-profile-screen.png`

3. **Test Edit Profile**
   - Tap "Edit Profile", "Edit", "تعديل"
   - Screenshot: `screenshots/settings/account/03-edit-mode.png`
   - Modify name field:
     - Clear existing text
     - Input ${TEST_NAME}
   - Screenshot: `screenshots/settings/account/04-name-changed.png`
   - Save changes (tap "Save", "Done", "حفظ")
   - Assert success (toast, confirmation, or updated profile)
   - Screenshot: `screenshots/settings/account/05-save-success.png`

4. **Verify Change Persisted**
   - Navigate away from profile
   - Return to profile screen
   - Assert ${TEST_NAME} visible
   - Screenshot: `screenshots/settings/account/06-change-persisted.png`

5. **Access Privacy Settings**
   - From settings or profile, find "Privacy", "الخصوصية"
   - Tap to enter privacy section
   - Screenshot: `screenshots/settings/account/07-privacy-screen.png`
   - Capture available privacy options (visibility, data, notifications)
   - Screenshot: `screenshots/settings/account/08-privacy-options.png`

6. **Toggle a Privacy Setting (if available)**
   - Find a toggle (notifications, visibility, etc.)
   - Tap to toggle
   - Screenshot: `screenshots/settings/account/09-privacy-toggled.png`
   - Toggle back
   - Screenshot: `screenshots/settings/account/10-privacy-restored.png`

7. **Final State**
   - Return to main settings
   - Screenshot: `screenshots/settings/account/11-final-state.png`

Use patterns:
- `anyOf` for bilingual text
- `runFlow` with `when` for conditional paths (edit button vs inline edit)
- `optional: true` for features that may not exist
  </action>
  <verify>Run `maestro test maestro/flows/settings/03-account-settings.yaml` - flow completes</verify>
  <done>Account settings flow exists with profile edit and privacy access tests</done>
</task>

<task type="auto">
  <name>Task 2: Update Config for Account Settings</name>
  <files>maestro/config.yaml</files>
  <action>
Update maestro/config.yaml to add account settings flow:

1. Add to existing `settings` section in `flows`:
   ```yaml
   settings:
     - maestro/flows/settings/01-theme-toggle.yaml
     - maestro/flows/settings/02-language-switch.yaml
     - maestro/flows/settings/03-account-settings.yaml  # NEW
   ```

2. Ensure proper YAML formatting
  </action>
  <verify>Validate YAML syntax</verify>
  <done>Config includes 03-account-settings.yaml in settings section</done>
</task>

</tasks>

<verification>
- Account settings flow file exists
- Flow tests profile editing and privacy access
- Flow uses bilingual text matching
- Config.yaml updated with new flow
- Screenshots capture profile state changes
</verification>

<success_criteria>
- `maestro/flows/settings/03-account-settings.yaml` exists with 60+ lines
- Flow tests: profile edit, save, persistence, privacy access
- Flow captures 10+ screenshots
- Config.yaml includes flow in settings section
</success_criteria>

<output>
After completion, create `.planning/phases/09-maestro-e2e-tests/09-04-SUMMARY.md`
</output>
